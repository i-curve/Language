[...返回上级目录](..)

# 数据库高级部分

> 简介: 数据库高级部分, 用于数据库管理

## 用户管理

mysql.user 这个表是有 host,name 共同组成了一个主键

1. 创建用户

```mysql
# 1. 创建用户
create user 'curve'@'%' identify with mysql_native_password by '123456';
# 2. 更新用户信息
# 更新mysql.user这个表即可
# 3. 删除用户
drop user 'curve'@'%';
# 4. 更改密码
alter user 'curve'@'%' identify with mysql_native_password by '123456';
```

## 权限管理

权限分为数据库权限, 表权限, 列权限

mysql.db, mysql.table_prive, mysql.table_prive

```mysql
# 1. 查看用户权限
show grants for 'curve'@'%';
# 2. 赋予用户权限
grant select on *.* to 'curve'@'%';
# 3. 回收权限
revoke select on *.* from 'curve'@'%';

##
# 赋予用户的权限默认是只能自己使用的, 如果想让用户有grant 的权限 , 需要添加参数;
```

## 数据库优化

数据库执行流程: 连接层-> 服务层(构建树和优化查询) -> 数据库引擎 -> 数据



数据库优化过程

1. 开机慢查询日志
2. 使用 explain 进行数据库语句分析 添加**索引**
3. show profile cpu,disk io for query 1; 查看
4. 数据库参数调优



> 索引: 索引是把该列单独组合成一组数据, 一般是b+tree的数据结构, 是一种排序过的数据,能够加快数据查询速度
>
> 命名规范:  idx\_表名\_小驼峰的列明组合

> 索引匹配规则:
>
> 1. 最佳左前缀匹配
> 2. 索引列上不能有函数和类型转换
> 3. 范围之后全失效(between, and, in)
> 4. like百分写最右
> 5. 忽略空值和or
> 6. 不等于 <>, != 也会失效

## 索引类型

> 聚簇索引:  主键索引( 唯一性索引)  和数据关联起来的
>
> 非聚簇索引: 普通索引,  会单独维护一个数据结构, 最低层包含了数据的id ,  最后是需要进行回表( 通过id 去找到数据)

- 适合创建索引的情况:
  - 在where条件中
  - 在group by, order by条件红
  - 数据列的散列值比较高



- 唯一索引不能重复, 但是可以有null

```mysql
# 1. 创建索引
create [unique] index idx_tbname_name(索引名) (`name`) on `table_name`;
# 2. 删除索引
drop index idx_tbname_name;
```

## EXPLAIN结果说明



- id: 数据执行的优先级, 越大优先级越高, 相等的话自上而下
- table: 数据执行所在的表
- type: system>const>eq_ref>ref>range>inex>all
- posibile_key: 可能用到的索引
- key: 实际用到的索引
- key_len: 实际使用索引个数的长度, 相同缩影情况下, 值越大越好
- row: 预估所需要查询的行数
- extra: using where,index/index condition; filesort(文件内排序)/ temproary( 创建临时表)
